# Вариант 5: Система обработки заявок (Help Desk)

### Легенда
Вы разрабатываете базу данных для системы поддержки клиентов (Help Desk). Система должна хранить информацию о клиентах, сотрудниках поддержки (агентах) и заявках (тикетах), которые клиенты создают.

*   **`Customers` (Клиенты):** информация о клиентах компании, которые обращаются в поддержку.
*   **`Agents` (Агенты):** информация о сотрудниках поддержки, которые обрабатывают заявки.
*   **`Tickets` (Заявки/Тикеты):** основная сущность, которая связывает заявку от клиента с назначенным на нее агентом, а также содержит статус, приоритет и описание проблемы.

---
### Задание 1: Проектирование и реализация (10 баллов)
1.  **Создайте ER-диаграмму** для таблиц `Customers`, `Agents`, `Tickets`. Определите атрибуты, типы данных, первичные и внешние ключи.
2.  **Напишите SQL-скрипт (`CREATE TABLE`)** для создания таблиц. Используйте `PRIMARY KEY`, `FOREIGN KEY` (например, с `ON DELETE SET NULL`, если агент увольняется, его заявки остаются), `NOT NULL`, тип данных `ENUM` для статуса (`'open'`, `'in_progress'`, `'closed'`) и `DEFAULT` для него же (`DEFAULT 'open'`).
3.  **Письменно обоснуйте**, почему ваша схема находится в **третьей нормальной форме (3NF)**.

---
### Задание 2: Работа с данными и сложные запросы (10 баллов)
1.  Наполните таблицы данными (5 клиентов, 3 агента, 15 заявок).
2.  **Напишите SQL-запросы:**
    *   **Простой `SELECT`:** Найти все заявки с приоритетом 'high' и статусом 'open'.
    *   **`UPDATE`:** Назначить одну из открытых заявок конкретному агенту и изменить ее статус на 'in\_progress'.
    *   **`SELECT` с `INNER JOIN`:** Показать все заявки (тема, дата создания), созданные клиентом "Петров Петр".
    *   **`SELECT` с `LEFT JOIN`:** Вывести список **всех** агентов и количество назначенных на них заявок в статусе 'in\_progress'.
    *   **`SELECT` с `GROUP BY` и `HAVING`:** Найти клиентов, которые создали более 2 заявок.
    *   **Сложный запрос:** Найти самого эффективного агента (того, кто закрыл (`status = 'closed'`) наибольшее количество заявок).

---
### Задание 3: Оптимизация и анализ схемы (10 баллов)
1.  **Анализ запроса:** Выполните `EXPLAIN` для запроса поиска заявки по ключевому слову в теме (`... WHERE subject LIKE '%проблема с доступом%'`). Объясните его неэффективность, указав на полный перебор таблицы.
2.  **Создание индекса:** Создайте индекс для поля `status` в таблице `Tickets`, чтобы ускорить поиск всех открытых или закрытых заявок. Напишите команду `CREATE INDEX`.
3.  **Реверс-инжиниринг:** Сгенерируйте схему вашей БД с помощью DBeaver или аналога.
4.  **Сравнение:** Сравните сгенерированную схему с вашей исходной ER-диаграммой и опишите различия (если они есть) и причины их возникновения.

***
