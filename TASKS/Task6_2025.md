# Вариант 6: Онлайн-кинотеатр

### Легенда
Вы разрабатываете БД для онлайн-кинотеатра. Система должна хранить информацию о фильмах, пользователях и оставленных ими отзывах.

*   **`Movies` (Фильмы):** каталог фильмов (название, режиссер, год выпуска, жанр).
*   **`Users` (Пользователи):** информация о зарегистрированных пользователях.
*   **`Reviews` (Отзывы):** связующая таблица, где хранится отзыв пользователя на фильм с оценкой и текстом.

---
### Задание 1: Проектирование и реализация (10 баллов)
1.  **Создайте ER-диаграмму** для таблиц `Movies`, `Users`, `Reviews`. Определите атрибуты, типы данных, ПК и ВК.
2.  **Напишите SQL-скрипт (`CREATE TABLE`)** для создания таблиц. Используйте `PRIMARY KEY`, `FOREIGN KEY`, `NOT NULL`, и ограничение `CHECK` для поля `rating` в `Reviews` (например, от 1 до 10).
3.  **Письменно обоснуйте**, почему ваша схема находится в **третьей нормальной форме (3NF)**.

---
### Задание 2: Работа с данными и сложные запросы (10 баллов)
1.  Наполните таблицы данными (5 фильмов, 4 пользователя, 15 отзывов).
2.  **Напишите SQL-запросы:**
    *   **Простой `SELECT`:** Найти все фильмы в жанре "Комедия", выпущенные после 2020 года.
    *   **`UPDATE`:** Пользователь решил изменить свой отзыв и оценку для фильма.
    *   **`SELECT` с `INNER JOIN`:** Показать все отзывы (текст, оценка), оставленные пользователем с определенным `username`.
    *   **`SELECT` с `LEFT JOIN`:** Вывести список **всех** фильмов и количество оставленных на них отзывов.
    *   **`SELECT` с `GROUP BY` и `AVG`:** Рассчитать средний рейтинг для каждого фильма.
    *   **Сложный запрос:** Найти пользователя, который оставил больше всего отзывов.

---
### Задание 3: Оптимизация и анализ схемы (10 баллов)
1.  **Анализ запроса:** Выполните `EXPLAIN` для запроса поиска пользователя по части email (`... WHERE email LIKE '%@mail.ru'`). Объясните его неэффективность.
2.  **Создание индекса:** Создайте индекс для поля `genre` в таблице `Movies`. Напишите команду `CREATE INDEX`.
3.  **Реверс-инжиниринг:** Сгенерируйте схему вашей БД с помощью DBeaver или аналога.
4.  **Сравнение:** Сравните сгенерированную схему с вашей исходной ER-диаграммой и опишите различия.

***
