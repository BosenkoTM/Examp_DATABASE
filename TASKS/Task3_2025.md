# Вариант 3: Библиотека

### Легенда
Вы разрабатываете БД для учета книг в библиотеке. Система должна хранить информацию о книгах, читателях и фактах выдачи книг.

*   **`Books` (Книги):** каталог книг (автор, название, год издания).
*   **`Readers` (Читатели):** данные о зарегистрированных читателях.
*   **`Borrows` (Выдачи):** связующая таблица, которая фиксирует, какой читатель взял какую книгу, когда и на какой срок.

---
### Задание 1: Проектирование и реализация (10 баллов)
1.  **Создайте ER-диаграмму** для таблиц `Books`, `Readers`, `Borrows`. Определите атрибуты, типы данных, первичные и внешние ключи.
2.  **Напишите SQL-скрипт (`CREATE TABLE`)** для создания таблиц. Включите ограничения `PRIMARY KEY`, `FOREIGN KEY`, `NOT NULL`, и `DEFAULT` для статуса выдачи (например, `DEFAULT 'active'`).
3.  **Письменно обоснуйте**, почему ваша схема находится в **третьей нормальной форме (3NF)**.

---
### Задание 2: Работа с данными и сложные запросы (10 баллов)
1.  Наполните таблицы тестовыми данными (10 книг, 5 читателей, 15 записей о выдаче).
2.  **Напишите SQL-запросы:**
    *   **Простой `SELECT`:** Найти все книги, написанные определенным автором.
    *   **`UPDATE`:** Отметить, что читатель вернул книгу (изменить `return_date` и статус).
    *   **`SELECT` с `INNER JOIN`:** Вывести список всех книг, которые сейчас на руках у читателя "Петров П.П.".
    *   **`SELECT` с `LEFT JOIN`:** Вывести список **всех** книг и количество раз, которое каждую из них брали. Книги, которые не брали ни разу, тоже должны быть в списке.
    *   **`SELECT` с `GROUP BY` и `HAVING`:** Найти читателей, которые брали книги более 3 раз.
    *   **Сложный запрос:** Найти самую популярную книгу (которую брали чаще всего).

---
### Задание 3: Оптимизация и анализ схемы (10 баллов)
1.  **Анализ запроса:** Выполните `EXPLAIN` для запроса поиска книги по части названия (`... WHERE title LIKE '%война%'`). Объясните, почему он приводит к полному сканированию таблицы.
2.  **Создание индекса:** Создайте индекс для поля `author` в таблице `Books` для ускорения поиска по автору. Напишите команду `CREATE INDEX`.
3.  **Реверс-инжиниринг:** Сгенерируйте схему вашей БД с помощью DBeaver или аналога.
4.  **Сравнение:** Сравните сгенерированную схему с вашей исходной ER-диаграммой и опишите различия.

***

