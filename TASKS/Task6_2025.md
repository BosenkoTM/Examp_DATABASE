# Вариант 6: Управление заказами в E-commerce

### Легенда
Вы разрабатываете базу данных для внутреннего учета заказов интернет-магазина. Система должна хранить информацию о товарах, клиентах и сделанных ими заказах.

*   **`Products` (Товары):** каталог товаров, которые продаются в магазине (наименование, категория, цена).
*   **`Customers` (Клиенты):** информация о зарегистрированных клиентах.
*   **`Orders` (Заказы):** транзакционная таблица, которая фиксирует, какой клиент, какой товар, в каком количестве и когда заказал, а также статус заказа.

---
### Задание 1: Проектирование и реализация (10 баллов)
1.  **Создайте ER-диаграмму** для таблиц `Products`, `Customers`, `Orders`. Определите атрибуты, типы данных, первичные и внешние ключи.
2.  **Напишите SQL-скрипт (`CREATE TABLE`)** для создания таблиц. Используйте `PRIMARY KEY`, `FOREIGN KEY`, `NOT NULL`, ограничение `CHECK` для количества (`quantity > 0`) и `ENUM` для статуса заказа (`'pending'`, `'shipped'`, `'delivered'`).
3.  **Письменно обоснуйте**, почему ваша схема находится в **третьей нормальной форме (3NF)**.

---
### Задание 2: Работа с данными и сложные запросы (10 баллов)
1.  Наполните таблицы данными (5 товаров, 4 клиента, 15 заказов).
2.  **Напишите SQL-запросы:**
    *   **Простой `SELECT`:** Найти все заказы со статусом 'pending', сумма которых (цена \* количество) превышает 10 000.
    *   **`UPDATE`:** Изменить статус одного из заказов с 'shipped' на 'delivered'.
    *   **`SELECT` с `INNER JOIN`:** Показать все заказы (название товара, количество, дата), сделанные клиентом с определенным `email`.
    *   **`SELECT` с `LEFT JOIN`:** Вывести список **всех** товаров и общее количество проданных единиц каждого товара. Товары, которые ни разу не заказывали, должны быть в списке с 0.
    *   **`SELECT` с `GROUP BY` и `SUM`:** Рассчитать общую выручку по каждой категории товаров.
    *   **Сложный запрос:** Найти самого лояльного клиента (по наибольшему количеству сделанных заказов).

---
### Задание 3: Оптимизация и анализ схемы (10 баллов)
1.  **Анализ запроса:** Выполните `EXPLAIN` для запроса поиска клиента по части его email-адреса (`... WHERE email LIKE '%@gmail.com'`). Объясните его неэффективность.
2.  **Создание индекса:** Создайте индекс для поля `category` в таблице `Products` для ускорения формирования отчетов по категориям. Напишите команду `CREATE INDEX`.
3.  **Реверс--инжиниринг:** Сгенерируйте схему вашей БД с помощью DBeaver или аналога.
4.  **Сравнение:** Сравните сгенерированную схему с вашей исходной ER-диаграммой и опишите различия.

***
